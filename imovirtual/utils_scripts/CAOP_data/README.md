# CAOP_data

This folder contains data and scripts related to the Portuguese administrative divisions (CAOP).

## Files

*   `caop_freguesias_4326.geojsonl`: Contains the geographical data of the Portuguese parishes (freguesias) in GeoJSONL format, using the EPSG:4326 coordinate system. This file is generated by the `upload_caop_to_gcp.py` script.
*   `upload_caop_to_gcp.py`: A Python script to upload the CAOP data to Google Cloud Platform (GCP). It performs the following steps:
    1.  Loads GCP credentials from environment variables.
    2.  Processes a GeoPackage (`Continente_CAOP2024.gpkg`) to a GeoJSON Lines file (`caop_freguesias_4326.geojsonl`). This involves reading the GeoPackage, reprojecting the data to EPSG:4326 if necessary, and saving it as GeoJSON Lines.
    3.  Uploads the GeoJSON Lines file to a specified GCS bucket.
    4.  Loads the data from the GCS bucket into a BigQuery table.
*   `utils.py`: A Python module containing utility functions used by the `upload_caop_to_gcp.py` script. It includes the following functions:
    *   `process_geopackage(source_gpkg, output_geojsonl)`: Reads a GeoPackage, reprojects it to EPSG:4326, and saves it as GeoJSON Lines.
    *   `upload_to_gcs(bucket_name, source_file_name, destination_blob_name, gcs_client)`: Uploads a file to a GCS bucket.
    *   `load_gcs_to_bigquery(gcs_uri, table_id, job_config, bq_client)`: Loads data from a GCS URI to a BigQuery table.